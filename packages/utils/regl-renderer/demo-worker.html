<!DOCTYPE html>
<html>
<head>
  <title>Demo Application</title>
    <style>
    body{background: #eee;}
      body,html{
        height: 100%;
        width: 100%;
        margin: 0;
      }
      body{
        display: flex;
        justify-content: stretch;
        align-items: stretch;
      }
      #canvas{
        width: 15cm;
        height: 15cm;
        margin: 0;
        outline: 1px solid black;
      }
      #scriptEdit{
        margin-top: 30px;
        flex: 1;
        overflow: auto;
      }
      #runButton{
        position: absolute;
      }
    </style>
</head>
<body>
  <button onclick="runScript()" id="runButton">Run script</button>
  <textarea id="scriptEdit">
const jscad = require('@jscad/modeling')
const { colorize, hslToRgb, hsvToRgb } = jscad.colors
const { cuboid } = jscad.primitives
const { translate } = jscad.transforms

const getTranslation = (x, y, z, steps) => {
  const spacing = 4
  return [
    (x - steps / 2) * spacing,
    (y - steps / 2) * spacing,
    (z - steps / 2) * spacing
  ]
}

const getColor = (a, b, c, method) => {
  if (method === 'hsl') return hslToRgb(a, b, c)
  else if (method === 'hsv') return hsvToRgb(a, b, c)
  else return [a, b, c]
}

/**
 * Creates a 9x9x9 cube showing color variations on the the 3 main spectra (rgb, hsv, hsl)
 * @param {String} params.method - The spectrum function to use: 'rgb'|'hsv'|'hsl'
 * @returns {[geometry]}
 */
const main = (params) => {
  const o = []
  const item = cuboid([1, 1, 1])
  const rows = 8
  for (let ix = 0; ix <= rows; ix++) {
    for (let iy = 0; iy <= rows; iy++) {
      for (let iz = 0; iz <= rows; iz++) {
        const cube = translate(getTranslation(ix, iy, iz, rows), item)
        const color = getColor(ix / rows, iy / rows, iz / rows, params.method)
        o.push(colorize(color, cube))
      }
    }
  }
  return o
}

const getParameterDefinitions = () => {
  return [
    {
      name: 'method',
      type: 'choice',
      caption: 'Colorize Method',
      values: ['rgb', 'hsv', 'hsl'],
      captions: ['(r,g,b) = (x,y,z)', '(h,s,v) = (x,y,z)', '(h,s,l) = (x,y,z)'],
      initial: 'hsl'
    }
  ]
}

module.exports = { main, getParameterDefinitions }
    
  </textarea>
  <canvas id="canvas"></canvas>


<script type="text/jscad" id="jscad_script">
// ********************
// The design to render
// ********************
const { booleans, colors, primitives } = require('@jscad/modeling') // modeling comes from the included MODELING library

const { intersect, subtract } = booleans
const { colorize } = colors
const { cube, cuboid, line, sphere, star } = primitives

const main = ({scale=1}) => {
  const logo = [
    colorize([1.0, 0.4, 1.0], subtract(
      cube({ size: 300 }),
      sphere({ radius: 200 })
    )),
    colorize([1.0, 1.0, 0], intersect(
      sphere({ radius: 130 }),
      cube({ size: 210 })
    ))
  ]

  const transpCube = colorize([1, 0, 0, 0.75], cuboid({ size: [100 * scale, 100, 210 + (200 * scale)] }))
  const star2D = star({ vertices: 8, innerRadius: 150, outerRadius: 200 })
  const line2D = colorize([1.0, 0, 0], line([[220, 220], [-220, 220], [-220, -220], [220, -220], [220, 220]]))

  return [transpCube, star2D, line2D, ...logo]
}
module.exports = {main}
</script>

<script src="demo-worker.js"></script>
<script>

const canvas = document.getElementById("canvas")

jscadRenderWorker.init({
  canvas,
  alias:[
    ['./dist/jscad-regl-renderer.min.js','@jscad/regl-renderer'],
  ],  
})

jscadRenderWorker.runScript({script:jscad_script.textContent, url:'jscad_script'})

function runScript(){
  let textArea = document.getElementById('scriptEdit')
  jscadRenderWorker.runScript({script:textArea.value, url:'jscad_script'}) 
}

</script>
</body>
</html>
